import requests
from colorama import Fore, Back, Style
from bs4 import BeautifulSoup
import pyxploitdb

def exploit_db(service):
    exploits = pyxploitdb.searchEDB(service,3)
    
    num = 1
    for exploit in exploits:
        print(Back.MAGENTA+Style.BRIGHT+Fore.LIGHTWHITE_EX+f'=> Exploit Number: {num} <= '+Style.RESET_ALL+'\n')
        print(Fore.YELLOW+f'Authors: '+Fore.WHITE+ f'{exploit.author} \n')
        print(Fore.YELLOW+f'ID: '+Fore.WHITE+ f'{exploit.id} \n')
        print(Fore.YELLOW+f'Platform: '+ Fore.WHITE+ f'{exploit.platform} \n')
        print(Fore.YELLOW+f'Description: '+ Fore.WHITE+ f'{exploit.description} \n')
        print(Fore.YELLOW+f'Port: '+Fore.WHITE+ f'{exploit.port} \n')
        print(Fore.YELLOW+f'Date Published: '+Fore.WHITE+f'{exploit.date_published} \n')
        print(Fore.YELLOW+f'Tags: '+Fore.WHITE+f'{exploit.tag_if_any} \n')
        print(Fore.YELLOW+f'Type: '+Fore.WHITE+f'{exploit.type} \n')
        print(Fore.YELLOW+f'Version: '+Fore.WHITE+f'{exploit.verified} \n')
        print(Fore.YELLOW+f'URL: '+Fore.CYAN+f'{exploit.link} \n')
        print(Fore.MAGENTA+"-----------------"+Style.RESET_ALL)
        num += 1
    
    
    # for exploit in exploits:
    #     print(exploit)
    # result = []


def get_last_exploits():
    '''summary:
    this function send request to https://www.exploit-db.com/
    and then extract last 10 New Exploit from main page'''
    
    url = 'https://www.exploit-db.com/'
    try:
        response = requests.get(url)
        print(response.text)
        soup = BeautifulSoup(response.content.decode(), 'html.parser')
        divExploits = soup.find_all('table')
        #print(divExploits)
        for div in divExploits:
            exploits = div.find_all('a', attrs={'href', ''})
            print(exploits)
            for exploit in exploits:
                print(exploit.text)
    
    except Exception as e:
        print('Error in get_last_exploits() \n')
        print(f'Error Content: {e}')
        
#get_last_exploits()
exploit_db()